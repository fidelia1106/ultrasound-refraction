<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>超声波斜入射：折射、反射与波型转换</title>

<style>
  :root{
    --bg:#ffffff;
    --panel:#f6f8ff;
    --card:#ffffff;
    --border:#e3e8f5;
    --text:#1b2333;
    --muted:#5b6a86;

    /* 介质颜色 */
    --m1:#d9e6ff;
    --m2:#f6dfbf;

    --m1tint:#eef4ff;
    --m2tint:#fff4e3;
    --m1line:#2e56b8;
    --m2line:#c27a00;

    /* 波线色 */
    --incL:#0a2a78;
    --incS:#d8362a;
    --L:#f39a1c;
    --S:#d8362a;

    /* 反射（略亮） */
    --rL:#2d58ff;
    --rS:#ff3b30;

    /* 法线 */
    --normal:#2e56b8;

    --shadow: 0 14px 34px rgba(18,34,80,.10);
    --interfaceY: 52%;
  }

  *{ box-sizing:border-box; }
  body{
    margin:0;
    font-family:"Microsoft YaHei","Segoe UI",sans-serif;
    background:var(--bg);
    color:var(--text);
  }

  header{
    height:56px;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:0 18px;
    border-bottom:1px solid var(--border);
    background:linear-gradient(90deg,#f7f9ff,#ffffff);
  }
  header .title{
    font-size:20px;
    font-weight:800;
    letter-spacing:.2px;
    text-align:center;
  }

  /* ===== 下标统一样式（关键：不让下标太小）===== */
  sub.sub{
    font-size:0.82em;           /* 下标相对主字符：保持清晰 */
    line-height:0;
    vertical-align:-0.28em;     /* 下沉一点但不过分 */
    font-weight:900;
    letter-spacing:0;
  }

  main{
    display:flex;
    gap:14px;
    padding:14px;
    align-items:stretch;
    min-height:calc(100dvh - 56px);
    flex-wrap:wrap;
  }

  .left{
    flex: 1 1 520px;
    display:flex;
    align-items:stretch;
    justify-content:center;
    min-width:320px;
  }

  .canvasWrap{
    width:100%;
    max-width: 1200px;
    height: calc(100dvh - 56px - 28px);
    max-height: 860px;
    border-radius:16px;
    overflow:hidden;
    border:1px solid var(--border);
    box-shadow: var(--shadow);
    background:#fff;
    position:relative;
  }
  canvas{ width:100%; height:100%; display:block; touch-action:none; }

  /* ===== 画布内 HUD ===== */
  .hud{
    position:absolute;
    z-index:10;
    pointer-events:auto;
    background:rgba(255,255,255,.92);
    border:1px solid rgba(227,232,245,.95);
    border-radius:12px;
    box-shadow: 0 10px 22px rgba(18,34,80,.10);
    backdrop-filter: blur(6px);
  }
  .hud .row{ margin:6px 0; grid-template-columns: 78px 1fr; }
  .hud label{ font-size:12px; }
  .hud select, .hud input[type="number"]{ height:32px; border-radius:10px; }

  .hudHead{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding:10px 12px;
    border-bottom:1px solid rgba(227,232,245,.95);
  }
  .hudHead .name{ font-weight:900; font-size:12px; color:#1f2e54; }
  .hudBody{ padding:10px 12px; }

  .hudActions{
    position:absolute;
    right:12px;
    top:12px;
    z-index:11;
    display:flex;
    gap:8px;
  }
  .btn{
    height:34px;
    padding:0 12px;
    border-radius:999px;
    border:1px solid rgba(227,232,245,.95);
    background:rgba(255,255,255,.92);
    color:#1b2333;
    font-weight:800;
    font-size:12px;
    cursor:pointer;
    box-shadow: 0 10px 22px rgba(18,34,80,.10);
  }
  .btn:active{ transform: translateY(1px); }

  /* ===== 抽屉面板 ===== */
  .drawer{
    position:fixed;
    right:12px;
    top:68px;
    bottom:12px;
    width:min(440px, calc(100vw - 24px));
    background:var(--panel);
    border:1px solid var(--border);
    border-radius:16px;
    box-shadow: var(--shadow);
    padding:14px;
    overflow:auto;
    z-index:100;
    display:none;
  }
  .drawer.open{ display:block; }
  .drawerTop{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px; }
  .drawerTop .title{ font-weight:900; color:#1f2e54; font-size:13px; }
  .drawerClose{ height:34px; padding:0 12px; border-radius:999px; border:1px solid var(--border); background:#fff; cursor:pointer; font-weight:800; }

  .grid{ display:grid; gap:12px; }

  .card{
    background:var(--card);
    border:1px solid var(--border);
    border-radius:14px;
    padding:12px;
    box-shadow: 0 10px 22px rgba(18,34,80,.06);
  }
  .card h3{
    margin:0 0 10px 0;
    font-size:13px;
    color:#2347a8;
  }

  .row{
    display:grid;
    grid-template-columns: 110px 1fr;
    gap:10px;
    align-items:center;
    margin:8px 0;
  }
  label{ font-size:13px; color:#2a3246; }

  select, input[type="number"]{
    height:34px;
    border-radius:10px;
    border:1px solid #dfe6fb;
    padding:0 10px;
    background:#fff;
    outline:none;
    font-size:13px;
    width:100%;
  }
  select:disabled, input:disabled{ opacity:.6; }

  .kv{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:10px;
    margin-top:8px;
  }
  @media (max-width: 520px){
    .kv{ grid-template-columns: 1fr; }
  }

  .box{
    border:1px dashed #dfe6fb;
    border-radius:12px;
    padding:10px;
    background:#fbfcff;
    min-height:64px;
  }
  .k{ font-size:12px; color:var(--muted); margin-bottom:4px; }
  .v{
    font-size:15px;
    font-weight:800;
    color:#182033;
    display:flex;
    align-items:baseline;
    gap:8px;
    flex-wrap:wrap;
  }
  .unit{ font-size:12px; color:var(--muted); font-weight:600; }

  .hint{
    margin-top:8px;
    font-size:12px;
    color:var(--muted);
    line-height:1.4;
  }

  .bigEq{
    font-size:18px;
    font-weight:900;
    color:#111a2e;
    line-height:1.35;
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    align-items:center;
  }
  .frac{
    display:inline-grid;
    grid-template-rows:auto auto;
    align-items:center;
    justify-items:center;
    padding:2px 6px;
    min-width:92px;
  }
  .frac .top{ padding-bottom:2px; }
  .frac .bar{
    width:100%;
    height:2px;
    background:#111a2e;
    opacity:.85;
    margin:1px 0;
  }
  .frac .bot{ padding-top:1px; }
  .eq{ font-size:18px; font-weight:900; margin:0 2px; }

  .legend{
    margin-top:10px;
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    color:var(--muted);
    font-size:12px;
  }
  .legend span{
    display:inline-flex;
    align-items:center;
    gap:6px;
    padding:6px 10px;
    border:1px solid var(--border);
    border-radius:999px;
    background:#fff;
  }

  /* ===== HUD Results（左图下方）===== */
  .hudResults{
    left:12px;
    bottom:12px;
    width:min(260px, calc(100% - 24px));
    background:rgba(255,255,255,.62);
    border:1px solid rgba(15,26,43,.10);
    backdrop-filter: blur(10px);
  }
  .hudResults .r3, .hudResults .r2{
    display:flex; align-items:baseline; gap:8px; flex-wrap:wrap;
  }
  .hudResults .r2{ margin-top:6px; }
  .hudResults .lab{ font-size:12px; color:#445; opacity:.85; min-width:22px; }
  .hudResults .val{ font-size:14px; font-weight:800; color:#0f1a2b; margin-right:10px; }

  /* ===== 介质按钮（浮贴）===== */
  .matBtn{
    position:absolute;
    left:14px;
    z-index:6;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    pointer-events:auto;
  }
  .matBtn.mat1{ top: calc(var(--interfaceY, 52%) - 58px); }
  .matBtn.mat2{ top: calc(var(--interfaceY, 52%) + 16px); }

  .matBtn.mat1 .btnPill{
    background: linear-gradient(180deg, rgba(238,244,255,.90), rgba(255,255,255,.55));
    border-color: rgba(46,86,184,.28);
    color: #0a2a78;
  }
  .matBtn.mat2 .btnPill{
    background: linear-gradient(180deg, rgba(255,244,227,.92), rgba(255,255,255,.55));
    border-color: rgba(194,122,0,.30);
    color: #7a4a00;
  }
  .matBtn .btnPill span{ color: inherit; }

  .btnPill{
    height:42px;
    padding:0 14px;
    border-radius:999px;
    font-weight:800;
  }

  /* 入射设置卡片（你当前已精简的版本） */
  .hudInc{
    position:absolute;
    left:12px;
    top:12px;
    width:min(220px, calc(100vw - 24px));
    z-index:5;
    border-radius:12px;
  }
  .hudInc .hudHead{ padding:6px 10px; }
  .hudInc .hudBody{ padding:8px 10px; }
  .hudInc .row{ grid-template-columns: 84px 1fr; gap:8px; margin:6px 0; }
  .hudInc label{ font-size:12px; }
  .hudInc select, .hudInc input[type="number"]{
    height:30px;
    border-radius:10px;
    font-size:12px;
  }
  .hudInc .hint{
    margin-top:6px;
    font-size:11px;
    color:#44506a;
    opacity:.9;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }

  /* 弹窗 */
  .modalOverlay{
    position:fixed;
    inset:0;
    background:rgba(15,26,43,.35);
    z-index:50;
  }
  .modal{
    position:fixed;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    width:min(520px, calc(100vw - 28px));
    background:rgba(255,255,255,.92);
    border:1px solid rgba(15,26,43,.12);
    border-radius:18px;
    box-shadow:0 20px 60px rgba(0,0,0,.22);
    z-index:60;
    overflow:hidden;
  }
  .modalTop{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:14px 16px;
    border-bottom:1px solid rgba(15,26,43,.08);
    font-weight:900;
  }
  .modalTitle{ font-size:14px; color:#0f1a2b; }
  .modalClose{
    width:34px; height:34px;
    border-radius:10px;
    border:1px solid rgba(15,26,43,.10);
    background:rgba(255,255,255,.7);
    cursor:pointer;
    font-size:18px;
    line-height:1;
  }
  .modalBody{ padding:14px 16px 16px; }
  .smallNote{ margin-top:10px; font-size:12px; color:#44506a; }

  @media (max-width: 560px){
    .hudInc{ top:60px; width:min(300px, calc(100vw - 28px)); }
    .matBtn{ gap:8px; }
    .btnPill{ height:40px; padding:0 12px; }
  }

  /* ===== 临界角面板（与整体统一）===== */
  .critEq{
    margin-top:4px;
    display:flex;
    align-items:center;
    justify-content:flex-start;
    gap:8px;
    flex-wrap:wrap;
    font-size:18px;
    font-weight:900;
    color:#111a2e;
    line-height:1.35;
  }
  .critEq .sym{ min-width:34px; }
  .critEq .fn{ letter-spacing:.2px; }
  .critEq .paren{ font-weight:900; opacity:.9; }
  .critEq .frac{ min-width:96px; }
  .critNote{
    margin-top:10px;
    padding:10px 12px;
    border:1px dashed #dfe6fb;
    border-radius:12px;
    background:#fbfcff;
    color:#44506a;
    font-size:12px;
    line-height:1.7;
    font-weight:700;
  }


  .symbolList{
    background:#fff;
    border:1px dashed #dfe6fb;
    border-radius:12px;
    padding:10px 12px;
    line-height:1.8;
    color:#1b2333;
    font-size:13px;
    font-weight:700;
  }
  .symbolList .line{
    display:block;
    margin:4px 0;
    color:#233055;
  }

  /* ===== 响应式：云创/小窗口自适应 =====
     思路：小屏下缩放“UI 卡片/按钮/结果面板”，避免遮挡与比例失衡
  */
  :root{ --uiScale: 1; }

  /* 这些属于 UI 叠层元素：缩放不影响画布坐标 */
  .incCard, .hud, .hudActions, .matBadge { transform-origin: left top; }

  @media (max-width: 1100px){
    :root{ --uiScale: .92; }
  }
  @media (max-width: 900px){
    :root{ --uiScale: .85; }
  }
  @media (max-width: 720px){
    :root{ --uiScale: .78; }
  }
  @media (max-width: 620px){
    :root{ --uiScale: .72; }
  }

  .incCard{ transform: scale(var(--uiScale)); }
  .hud{ transform: scale(var(--uiScale)); transform-origin: left bottom; }
  .hudActions{ transform: scale(var(--uiScale)); transform-origin: right top; }
  .matBadge{ transform: scale(var(--uiScale)); }

  /* 入射设置卡片宽度随屏幕收敛 */
  .incCard{
    max-width: clamp(220px, 34vw, 320px);
  }
  .incCard .row{ gap:10px; }
  .incCard label{ font-size:12px; }
  .incCard .hint{ font-size:11px; }

  /* 小屏时按钮排布更紧凑，避免右上溢出 */
  @media (max-width: 720px){
    .hudActions{ gap:8px; right:12px; top:12px; }
    .btn{ padding:8px 12px; font-size:12px; }
  }


  /* ===== 弹窗/抽屉也跟随 uiScale 缩放 ===== */
  .modal{
    transform: translate(-50%,-50%) scale(var(--uiScale));
    transform-origin: center;
  }
  .drawer{
    transform: scale(var(--uiScale));
    transform-origin: right top;
  }

</style>
</head>

<body>
<header>
  <div class="title">超声波斜入射时的反射、折射和波形转换</div>
</header>

<main>
  <section class="left">
    <div class="canvasWrap" id="canvasWrap">
      <canvas id="scene"></canvas>

      <div class="hudActions">
        <button class="btn" id="btnFormula" type="button">反射 / 折射定律</button>
        <button class="btn" id="btnCritical" type="button">临界角</button>
      </div>

      <!-- 介质按钮 -->
      <div class="matBtn mat1" aria-label="介质1选择按钮">
        <button class="btn btnPill" id="btnMat1" type="button">介质1：<span id="mat1BtnName">有机玻璃</span></button>
      </div>
      <div class="matBtn mat2" aria-label="介质2选择按钮">
        <button class="btn btnPill" id="btnMat2" type="button">介质2：<span id="mat2BtnName">钢</span></button>
      </div>

      <!-- 左上：入射波设置 -->
      <div class="hud hudInc" aria-label="入射波设置">
        <div class="hudHead">
          <div class="name">入射波类型设置</div>
        </div>
        <div class="hudBody">
          <div class="row">
            <label>入射波类型</label>
            <select id="incType">
              <option value="L" selected>纵波 L</option>
              <option value="S">横波 S</option>
            </select>
          </div>
          <div class="row">
            <label><span id="alphaLabel">入射角 α<sub class="sub">L</sub>（°）</span></label>
            <input id="alphaInput" type="number" min="0" max="90" step="0.1" value="30" />
          </div>
          <div class="hint" id="dragHint">提示：拖动入射波可调整入射角</div>
        </div>
      </div>

      <!-- 弹窗遮罩 -->
      <div class="modalOverlay" id="modalOverlay" hidden></div>

      <!-- 介质1弹窗 -->
      <div class="modal" id="modalMat1" hidden aria-label="介质1设置">
        <div class="modalTop">
          <div class="modalTitle">介质1（入射 / 反射区）</div>
          <button class="modalClose" type="button" data-close="1">×</button>
        </div>
        <div class="modalBody">
          <div class="row">
            <label>材料</label>
            <select id="mat1"></select>
          </div>
          <div class="kv">
            <div class="box">
              <div class="k">纵波声速 c<sub class="sub">L1</sub></div>
              <div class="v"><span id="cL1">—</span> <span class="unit">m/s</span></div>
            </div>
            <div class="box">
              <div class="k">横波声速 c<sub class="sub">S1</sub></div>
              <div class="v"><span id="cS1">—</span> <span class="unit">m/s</span></div>
            </div>
          </div>
          <div class="smallNote" id="mat1Note"></div>
        </div>
      </div>

      <!-- 介质2弹窗 -->
      <div class="modal" id="modalMat2" hidden aria-label="介质2设置">
        <div class="modalTop">
          <div class="modalTitle">介质2（折射区）</div>
          <button class="modalClose" type="button" data-close="1">×</button>
        </div>
        <div class="modalBody">
          <div class="row">
            <label>材料</label>
            <select id="mat2"></select>
          </div>
          <div class="kv">
            <div class="box">
              <div class="k">纵波声速 c<sub class="sub">L2</sub></div>
              <div class="v"><span id="cL2">—</span> <span class="unit">m/s</span></div>
            </div>
            <div class="box">
              <div class="k">横波声速 c<sub class="sub">S2</sub></div>
              <div class="v"><span id="cS2">—</span> <span class="unit">m/s</span></div>
            </div>
          </div>
          <div class="smallNote" id="mat2Note"></div>
        </div>
      </div>

      <!-- 关键结果 HUD -->
      <div class="hud hudResults" aria-label="关键计算结果">
        <div class="hudBody">
          <div class="r3">
            <span class="lab">α<sub class="sub">1</sub></span><span class="val" id="alpha1Out">—</span>
            <span class="lab">α<sub class="sub">2</sub></span><span class="val" id="alpha2Out">—</span>
            <span class="lab">α<sub class="sub">3</sub></span><span class="val" id="alpha3Out">—</span>
          </div>
          <div class="r2">
            <span class="lab">γ<sub class="sub">L</sub></span><span class="val" id="gammaLOut">—</span>
            <span class="lab">γ<sub class="sub">S</sub></span><span class="val" id="gammaSOut">—</span>
          </div>
          <div class="r2">
            <span class="lab">β<sub class="sub">L</sub></span><span class="val" id="betaLOut">—</span>
            <span class="lab">β<sub class="sub">S</sub></span><span class="val" id="betaSOut">—</span>
          </div>
        </div>
      </div>

      <!-- 抽屉 -->
      <div class="drawer" id="drawer" aria-label="反射 / 折射定律面板">
        <div class="drawerTop">
          <div class="title">反射 / 折射定律</div>
          <button class="drawerClose" id="btnCloseDrawer" type="button">关闭</button>
        </div>

        <div class="grid">
          <div class="card">
            <h3>反射定律</h3>
            <div class="bigEq" id="reflectEq"></div>
            <div class="legend" id="reflectLegend"></div>
          </div>

          <div class="card">
            <h3>折射定律</h3>
            <div class="bigEq" id="refractEq"></div>
            <div class="legend" id="refractLegend"></div>
          </div>

          <div class="card">
            <h3>参数含义</h3>
            <div class="symbolList" id="symbolLegend"></div>
          </div>
        </div>
      </div>
      <!-- 临界角抽屉 -->
      <div class="drawer" id="drawerCritical" aria-label="临界角面板">
        <div class="drawerTop">
          <div class="title">临界角</div>
          <button class="drawerClose" id="btnCloseCritical" type="button">关闭</button>
        </div>

        <div class="grid">
          <div class="card">
            <h3>第一临界角</h3>
            <div class="critEq">
              <span class="sym">α<sub class="sub">1</sub></span>
              <span class="eq">=</span>
              <span class="fn">arcsin</span>
              <span class="paren">(</span>
              <span class="frac">
                <span class="top">c<sub class="sub">L1</sub></span>
                <span class="bar"></span>
                <span class="bot">c<sub class="sub">L2</sub></span>
              </span>
              <span class="paren">)</span>
            </div>
            <div class="critNote">
              若 c<sub class="sub">L2</sub> &gt; c<sub class="sub">L1</sub>，则 β<sub class="sub">L</sub>=90° 对应的纵波入射角称为第一临界角，用 α<sub class="sub">1</sub> 表示。
            </div>
          </div>

          <div class="card">
            <h3>第二临界角</h3>
            <div class="critEq">
              <span class="sym">α<sub class="sub">2</sub></span>
              <span class="eq">=</span>
              <span class="fn">arcsin</span>
              <span class="paren">(</span>
              <span class="frac">
                <span class="top">c<sub class="sub">L1</sub></span>
                <span class="bar"></span>
                <span class="bot">c<sub class="sub">S2</sub></span>
              </span>
              <span class="paren">)</span>
            </div>
            <div class="critNote">
              若 c<sub class="sub">S2</sub> &gt; c<sub class="sub">L1</sub>，则 β<sub class="sub">S</sub>=90° 对应的纵波入射角称为第二临界角，用 α<sub class="sub">2</sub> 表示。
            </div>
          </div>

          <div class="card">
            <h3>第三临界角</h3>
            <div class="critEq">
              <span class="sym">α<sub class="sub">3</sub></span>
              <span class="eq">=</span>
              <span class="fn">arcsin</span>
              <span class="paren">(</span>
              <span class="frac">
                <span class="top">c<sub class="sub">S1</sub></span>
                <span class="bar"></span>
                <span class="bot">c<sub class="sub">L1</sub></span>
              </span>
              <span class="paren">)</span>
            </div>
            <div class="critNote">
              当 γ<sub class="sub">L</sub>=90° 时，对应的横波入射角称为第三临界角，用 α<sub class="sub">3</sub> 表示。
            </div>
          </div>
        </div>
      </div>

      <script src="physics.js"></script>
      <script src="inline.js"></script>
    </div>
  </section>
</main>
</body>
</html>
